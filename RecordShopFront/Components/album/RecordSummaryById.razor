@using System.Text.Json
@using System.Text
<div>
<EditForm Model="Record" OnValidSubmit="Submit">
    <label for="Title">Title </label>
    <InputText @bind-Value="Record.Title" />
    <label for="Description">Description</label>
    <InputText @bind-Value="Record.Description" />
    <button type="submit">Save</button>
</EditForm>
</div>
<div>
    <h3>Add Genre to Album</h3>
    <EditForm Model="Genre" OnValidSubmit="Submit3">
        <label for="Genre">Genre</label>
        
    </EditForm>
</div>

       
  


@code {
    [Parameter]
    public AlbumReadDto Record { get; set; }
    public AlbumGenreWriteDto Genre { get; set; }



    protected override async Task OnInitializedAsync()
    {
        AlbumReadDto Album = new()
            {
                Title = "Abbey Road",
                Description = "kdfahdklfhakldfhakld",
                Genres = new List<AlbumGenreReadDto>
                {
                    new AlbumGenreReadDto
                    {
                        Genre = Genre.Rock
                    }
                },
                ArtistJunction = new List<ArtistAlbumJunctionReadDto>
                {
                    new ArtistAlbumJunctionReadDto
                    {
                        Artist = new(){
                            Id = 1,
                            Name = "The Beatles"
                        }
                    }
                }
            };
    }

    private void Submit()
    {
        HttpClient httpClient = new HttpClient();
        var content = new StringContent(JsonSerializer.Serialize(Record), Encoding.UTF8, "application/json");
        var response = httpClient.PostAsync("https://localhost:7097/api/album", content).Result;
        if (response.IsSuccessStatusCode)
        {
            Console.WriteLine("Success");
        }
        else
        {
            Console.WriteLine("Fail");
        }
    }

    private void Submit3()
    {
        //genre must be enum. maybe dropdown
        Genre.AlbumId = Record.Id;
        Console.WriteLine("Genre Added");
    }
    

}
